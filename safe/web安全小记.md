# 来段废话

前阵子网站安全出现了问题，忙碌过后，终于抽得闲暇，对自己了解的安全知识进行一下汇总、分析与整理。算是小记，也给自己一个动力，争取早点把手中这本《白帽子讲web安全》看完。

作为业务系统开发的程序员，一般情况下，我们遇到的安全隐患比较表层一些，相对于很底层的系统、网络安全来说，技术含量必然没有那么高，但是，造成的严重性却不容忽视。

## 我的安全分类

### 1. 弱口令

说起弱口令，这个绝对是互联网90%的安全隐患来源。除了像123456、000000这类的简单到闭着眼就能蒙到的密码，一些网站被拖库，泄露出来的密码也可以算作这一类。看似，我改一个密码就OK了；一般人的习惯会在自身熟悉的东西翻来覆去的组合，而很不巧，我改来改去，改回了以前一个密码。

然后我的企业邮箱被弱口令了0.0

作为公司里，拥有最高权限的开发人员，黑客大人立刻通过我的邮箱，获得了内网漫游的能力，各种服务器线上权限可以让他为所欲为……

索性，我们有运维，我的权限不是root。

索性，我们的安全机制足够，即便被拖库，黑客也没有办法获取用户的密码。

弱口令的危害性绝对是需要大家慎重再慎重的！

### 2.过滤类(SQL注入、XSS)

经典的安全攻击方式，有些时候对网站系统的危害极大。

但是，只要能够有效的过滤关键词、关键符号就可以将问题解决。当然，有些业务要求，有的功能需要进行一些标签类的添加（富文本编辑器之类的），这个就要对安全边界进行界定，这类情况一般会对拥有权限的用户进行IP限定、实名限定等，更严格而又宽松的正则检查方式等。

PS：
1. 对于SQL注入，首先要防止跳过引号
2. 对于XSS，则要放置script标签的写入

### 3.权限类(上传文件、一句话、shell)

对于服务器的写入权限一定要小心，记得刚入行的时候，同事的网站被黑，黑客在内网来回跳，影响了服务器上的所有项目。联系到小黑客，虚心请教发现，其实本质是黑客通过弱口令登录了后台（90%-.-），然后通过fckeditor（富文本编辑器）上传了asp、jsp、php脚本，查看了服务器信息。然后，他发现拥有777……

起始对于这一类的问题，最主要的是不要给自己留有余地。

如果你的服务器本身不具备写入权限，你的文件存储，本身不存储在业务服务器上，你的环境配置禁用了shell调用函数，那么一般的攻击手段对你来说可能已经可以防御住了

### 4.设计类

这一类的安全隐患，一般出现在功能设计方面，需要的是程序员的内功修炼和业务逻辑性。除了对于上述的一些基本点要知晓，还要知道如何防御；对于流程的控制上也要有自己的清晰的认知。

举一个例子：

短信验证码被恶意调用……

同事加了个验证码进行防御-。-

囧……

真对于这类的情况，我们需要知道我们在做什么……

我们要知道如何阻止恶意频繁调用……

第一步，我们在session里面加个时间戳，记录上次发送时间，在对方第二次访问的时候，我们可以比对时间戳，计算发送间隔，决定是否响应发送短信。

第二步，如果对方清除了cookie，session失效了；那我们要通过其他的手段存储发送信息（包括请求用户的IP、上次发送时间），比如MySQL、Redis、本地文件等，只要能记录到，查询到，依旧是检查发送间隔

第三步，对方换IP，我们的防御貌似又被攻破了；这个时候，我们就需要防御策略了，通过分析近期（可以是一个小时也可以是更久，根据实际情况）的记录，我们可疑发现一些不正常的数据：比方说，1个小时内，同一IP注册短信被请求了10次、20次，说明这个IP有问题，如果他不是特定的业务场景，那么我们基本可以讲这个IP加入黑名单了……

虽然不能说100%的安全，但是我们可以说，基本上已经很安全了。

### 5.业务类

业务类的事情比较特殊一些，它牵扯到实际的业务场景，有些时候业务需要，我们可能不得不放弃一些东西；但是，如果可能，我们要想办法讲业务调整到相对安全。当然，这里面牵扯到的是沟通能力问题。简单的办法就是让业务人员只用语言描述出他们的整个业务流程，这个过程中，我们可以补充，添加，然后整合，最后看看这个故事是否存在漏洞，或者说不通的敌方，而对于存在疑点的地方就要小心得应对。有些时候，业务的一个字的需求变更，可能就会让很多问题迎刃而解……

### 6.社工类

社会工程学是一门学问，也是绝大多数程序员最容易中招的敌方。而我，就是那个幸运的傻蛋。

故事开始：

小黑客，发现了我们的网站，然后他果断去GitHub上面搜索了一下sanhao，然后作为当事人的我的企业邮箱写在了开源代码的配置文件里，不巧的是，还有我的私人QQ。然后把QQ扔到社工库，密码出来，通过企业邮箱尝试，KO……

故事的高潮：

内网漫游，各种数据库、vpn、svn、gitlab、服务器权限，让黑客大人轻轻松松透视了我们……

故事的结尾：

很幸运，我们遇到的是白帽子，不做黑产，然后，各种感谢，各种礼物，各种改密码……

这是切身体会，技术防御只是web安全的一部分。

认识的黑客网友，直接通过电话索要某公司的业务资料，回复邮件植入木马……

QQ聊天，发送钓鱼网站骗取账号密码……

谎称某某某，加入我们公司的群，意图获取群信息……

web安全包括很多点，而任何一点的问题都会被无限放大，最终导致整体崩溃。

### 7.技术类

关于这个类别，受技术水平和经验限制，只能大概说下自己知道的一些。比方说遇到通过十六进制或者八进制对你的服务器进行攻击、通过操作系统的漏洞进行攻击；还有最无解的DDos等

对于前边的技术类别，我们只能是多关注安全领域的信息，积极的打补丁，多沉淀些安全技术底蕴。

而对于DDos类的攻击，怎么说呢。前阵子被莫名其妙的打进了黑洞，研究了一下，又不了了之了。对于这种，更多的认知还是在于购买更强大的服务（带宽）用于抵抗；通过主备来防止业务瘫痪无法回复；或者做一个其他的域名，放置对方追着域名打的时候，没有办法恢复过来。

### 8.APT

只有前日做贼，哪有千日防贼

如果遇到这种情况，在我看来，既是悲剧，又是机遇与挑战。

面对这种情况，我们需要做的是，从技术、业务、公司、管理、领域、圈子，方方面面都要做到“安全”。

木桶原理，任何一个方面的漏洞，都会被抓住机会，彻底击溃。而如果我们能够在APT之下坚持生存下去，我们所获得的收获，也将是前所未有的。

## 结个尾吧

不知不觉写了这么多内容，但其实任何一个点都可以展开来写上一篇甚至几篇，但这只是一个小记而已，记录下现在这个还不够不成熟的我。

无论是安全、还是其他，我要走的路还很长很长……

脚踏实地，增加自己的深度，积累自己的沉淀，才是最重要的。
